<!DOCTYPE html> 
<html> 
<head> 
	
	<title>MassKara 2012</title> 

	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	
	<link rel="stylesheet" href="css/jquery.mobile-1.2.0-rc.1.min.css" />

	<style type="text/css">
		#pMain_Content .pm_content {
			display:none;
		}

	</style>
	
	<script src="js/jquery-1.8.1.min.js"></script>

	<script>
/******************************************************************************************
			Global Var
*******************************************************************************************/
		var $pMain, $pMain_HD, $pMain_Content;
		var $pMain_Cal, $pMC_Sel, $pMC_LB, $pMC_RB, $pMC_SelPL, $pMC_Popup;
		var $NB_Sch, $NB_Venue, $NB_Fav, $NB_Info;
		var $c_Sch, $c_Venue, $c_Fav, $c_Info;
		var $c_Sch_List;

		var gObj_cNB; // Current Navi Content Info
		var gObj_Cal_UI; // Calendar UI

		var gArr_place, gArr_sList;
		var gArr_weekDay, gArr_sWeekDay, gArr_month, gArr_sMonth;


/****************************************************************
			Navi Bar Object
****************************************************************/
		function MK_Navi( $NB , $content ){
			this.$NB = $NB;
			this.$content = $content;
		}


		MK_Navi.prototype = {
			constructor: MK_Navi,
			
			show : function () {  // Show Content
				this.$content.show();
			},

			change : function ( $new_NB , $new_content ) {  // Change Content

				if ( $new_NB ==  this.$NB ) {
					return;
				}

				// Navi Bar State
				this.$NB.removeClass("ui-state-persist");
				$new_NB.addClass("ui-state-persist");

				// Check Calender
				if ( $new_NB == $NB_Sch ) {
					$pMain_Cal.show().trigger( 'updatelayout' );
				} else if ( this.$NB == $NB_Sch ) {
					$pMain_Cal.hide().trigger( 'updatelayout' );
				}

				this.$NB = $new_NB;

				// Change Content 
				this.$content.hide();
				$new_content.show();
				this.$content = $new_content;
			}	


		};

/****************************************************************
			Schedule Object
****************************************************************/
		function MK_Schedule(time, title, place, detail){
			this.time = time;
		    this.title = title;
			this.place = place;
			this.detail = detail;
		}

		MK_Schedule.prototype = {
			constructor: MK_Schedule
		};


/****************************************************************
			DaySchedules Object
****************************************************************/
		function MK_DaySchedules( sDate , sList ){
			this.sDate = sDate;
			this.sList = sList; // array of Schedules on sDate
		}

		MK_Schedule.prototype = {
			constructor: MK_DaySchedules
		};

/****************************************************************
			Place Object
****************************************************************/
		function MK_Place(name, addr, latlng){
			this.name = name;
			this.addr = addr;
			this.latlng = latlng;
		}

		MK_Place.prototype = {
			constructor: MK_Place
		};

/****************************************************************
			Calendar UI Object
****************************************************************/
		function MK_UI_Calendar ( ) {
			var sListLength = gArr_sList.length;

			var fDay = gArr_sList[0].sDate;
			var lDay = gArr_sList[sListLength - 1].sDate;
			var today = new Date();
			var selDay; // Selected Day
			var idx; // Selected Day Index in gArr_sList

//today.setFullYear(2012,9,20); // for test

			today.setHours(0);
			today.setMinutes(0);
			today.setSeconds(0);
			today.setMilliseconds(0);

			if( cmp_date( today , fDay ) == -1 ) {
			// Before MassKara : Show fDay
				selDay = fDay;
				idx = 0;

			} else if (cmp_date( today , lDay ) == 1) {
			// After MassKara : Show lDay
				selDay = lDay;
				idx = sListLength - 1;
			
			} else {
			// During MassKara
				for( var i = 0; i < sListLength; i++ ) {
					var itm = gArr_sList[i].sDate;

					if( cmp_date( today , itm) <= 0 ) {
						selDay = itm;
						idx = i;

						break;
					}
				}
			}


			this.idx = idx; // Selected Day Index in gArr_sList


			this.update_UI_Calender();

		} // function MK_UI_Calendar
				
		MK_UI_Calendar.prototype = {
			constructor: MK_UI_Calendar

			, showList : function () {
				
				var sList = gArr_sList[this.idx].sList;
				var cDay = gArr_sList[this.idx].sDate;
				var tDay = gArr_weekDay[ cDay.getDay() ] + " " + cDay.getDate() + " " + gArr_month[cDay.getMonth()] + " " + cDay.getFullYear();

				var txt = '<li data-role="list-divider"><h3 class="ui-li-heading">' + tDay + '</h3></li>';

				for ( var i=0, iCnt= sList.length; i < iCnt; i++ ) {
					var cs = sList[i];
					var title = cs.title;
					var pidx = cs.place;
					var place = ( isUD( gArr_place[pidx] ) ? "" : " @ " + gArr_place[pidx].name );

					txt += '<li><a><img src="img/star.png" class="ui-li-icon" />';
					txt += '<h3 class="ui-li-heading">' + title + '</h3>';
					txt += '<p class="ui-li-desc">' + getSTime( cs ) + place + '</p></a></li>';			
				}

				$c_Sch_List.html(txt).listview('refresh');
			}

			, setCalUI : function () {

				$pMC_Sel.text(this.getBtnTxt( this.idx , 0 )).button('refresh');

				// Set Left, Right Buttons
				if ( this.idx == 0 ) {
					// Hide Left Button
					$pMC_LB.parent().hide();
					$pMC_RB.text( this.getBtnTxt( 1 ) ).button('refresh');
				
				} else if ( this.idx == gArr_sList.length - 1 ) {
					// Hide Right Button
					$pMC_RB.parent().hide();
					$pMC_LB.text( this.getBtnTxt( this.idx - 1 ) ).button('refresh');

				} else {
					if($pMC_RB.parent().css("display") == "none") $pMC_RB.parent().show();
					if($pMC_LB.parent().css("display") == "none") $pMC_LB.parent().show();

					$pMC_LB.text( this.getBtnTxt( this.idx - 1 ) ).button('refresh');
					$pMC_RB.text( this.getBtnTxt( this.idx + 1 ) ).button('refresh');
				}


			}

			, update_selPL : function (){
				var txt = '<li data-role="list-divider" data-idx="-1">Select Day</li>';
				var theme = ["a", "c"];

				var theme_count = 0;

				for ( var i = 0, iCount = gArr_sList.length; i < iCount; i++ ) {
					
					if( i == this.idx ) continue;

					var iDate = gArr_sList[i].sDate;
					var txtDay =  "" + gArr_sWeekDay[ iDate.getDay() ] + " " + iDate.getDate() + " " + gArr_sMonth[iDate.getMonth()];

					txt += '<li data-icon="false" data-theme="' + theme[ theme_count++ % 2 ] + '" data-idx="' + i + '">';
					txt += '<p class="ui-li-desc"><b>' + txtDay  + '</b></p>';
					txt += '<span class="ui-li-count">' + gArr_sList[i].sList.length + '</span></li>';
				}

				$pMC_SelPL.html(txt).listview('refresh');
			}

			, update_UI_Calender : function() {
				this.setCalUI();
				this.showList();
			}

			, getBtnTxt : function ( i , type ) {
				var iDay = gArr_sList[i].sDate;

				if( type == 0 )
					return ( "" + gArr_sWeekDay[iDay.getDay()] + " " + iDay.getDate()  );
				else
					return ( "" + iDay.getDate() + " " + gArr_sMonth[ iDay.getMonth() ] );
			}

			, click_RBtn : function( ) {
				this.idx++;
				this.update_UI_Calender();
			}

			, click_LBtn : function( ) {
				this.idx--;
				this.update_UI_Calender();
			}

			, select_pDate : function( idx ) {
				this.idx = idx;
				this.update_UI_Calender();
			}
		};


/******************************************************************************************
			Util Functions
*******************************************************************************************/
		// Check undefined
		function isUD ( v ) {
			return ( typeof ( v ) == "undefined" ? true : false );
		}

		// Conlose Log
		function log( v ) {
			if ( typeof ( console ) != "undefined" ) {
				console.log( v );	
			}
		}


		// Return  -1 : di is old date ,  0 : d1 == d2 ,  1 : d2 is old date
		function cmp_date( d1 , d2 ) {

			var d1Time = d1.getTime();
			var d2Time = d2.getTime();

			if( d1Time > d2Time ) return 1;

			if( d1Time < d2Time ) return -1;
			else return 0;
		}

		// Get Schedule Time
		function getSTime ( sData ) {
			var sTime = ( typeof(sData.time) == "object") ? ( sData.time[0] + " - " + sData.time[1] ) : sData.time;

			return sTime;
		}

/******************************************************************************************
			Init Functions
*******************************************************************************************/
		function init_vals(){
			gArr_weekDay = [ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" ];
			gArr_sWeekDay = [ "SU", "MO", "TU", "WE", "TH", "FR", "SA" ];
			gArr_month = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "Decmber"];
			gArr_sMonth = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
		}

		function init_Selectors ( ) {
			$pMain_HD = $pMain.children("#pMain_HD");
			$pMain_Content = $pMain.children("#pMain_Content");
			$pMain_Cal = $pMain_HD.children("#pMain_Cal");
			$pMC_Sel = $pMain_Cal.find("#pMC_Sel"); 
			$pMC_LB = $pMain_Cal.find("#pMC_LB");
			$pMC_RB = $pMain_Cal.find("#pMC_RB");
			$pMC_Popup = $("#popupSelDate");
			$pMC_SelPL = $pMC_Popup.find("ul");

			$NB_Sch = $pMain_HD.find("ul #NB_Sch");
			$NB_Venue = $pMain_HD.find("ul #NB_Venue");
			$NB_Fav = $pMain_HD.find("ul #NB_Fav");
			$NB_Info = $pMain_HD.find("ul #NB_Info");

			$c_Sch = $pMain_Content.children("#c_Sch");
			$c_Venue = $pMain_Content.children("#c_Venue");
			$c_Fav = $pMain_Content.children("#c_Fav");
			$c_Info = $pMain_Content.children("#c_Info");	
			
			$c_Sch_List = $c_Sch.children("ul"); // Schedule List
		}

		function init_Places ( ) {
			gArr_place = [
								new MK_Place( "Bacolod Public Plaza", "Downtown Bacolod City Philippines", ["10.669296", "122.946421"] )
								, new MK_Place( "MassKara Carnival Site", "Downtown Bacolod City Philippines", ["10.669590293779533", "122.94514378585814"] )
								, new MK_Place( "SM City Event Center", "Rizal Street Bacolod City Philippines", ["10.671865857143", "122.9439727"] )
								, new MK_Place( "Tourism Strip", "Lacson Street Bacolod City Philippines", ["10.67896135166121", "122.95415734438487"] )
								, new MK_Place( "Ground Floor, LCC Rizal Main Gate", "Downtown Bacolod City Philippines", ["10.669590293779533", "122.94514378585814"] )
								, new MK_Place( "Orange Gallery", "Art District Bacolod City Philippines", ["10.669590293779533", "122.94514378585814"] )
							];
		}

		function init_Schedules ( ) {

			// Schedule Dates
			var mkYear = 2012;
			var mkMonth = 9;
			var allDay = "all-day";
			var sDate, sList;

			gArr_sList = [];

			// 2012 Oct 1
			sDate = new Date(mkYear, mkMonth, 1);
			sList = [
						new MK_Schedule(allDay, "Opening of the Festival sites", 0)
						, new MK_Schedule(allDay, "Opening of Carnival sites", 1)
						, new MK_Schedule(allDay, "GMA DanssKara:The MassKara Dance Showdown Eliminations")
						, new MK_Schedule(allDay, "Fireworks")
						, new MK_Schedule(["7:00 pm", "11:00 pm"], "Opening of 2012 MassKara Festival and DanssKara Elimination (GMA Dance Showdown)", 0)
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 5
			sDate = new Date(mkYear, mkMonth, 5);
			sList = [
						new MK_Schedule(allDay, "MassKara Art Weekend", undefined,"Opening of art events: MassKara 9 group show, Magika MassKara, Art Tour")
						, new MK_Schedule(["7:00 pm", "10:00 pm"], "Unveiling: Majika MassKara 9: Ang Bukid Kag Baybay sa Bacolod", 0)
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 6
			sDate = new Date(mkYear, mkMonth, 6);
			sList = [
						new MK_Schedule(allDay, "MassKara Art Weekend")
						, new MK_Schedule(["5:00 pm", "6:00 pm"], "Opening: LCC Giant MassKara Puppets Replica Exhibits", 4)
						, new MK_Schedule(["6:00 pm", "8:00 pm"], "Opening: 9D - A Visual Arts Exhibit by the MassKara 9", 5)
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 7
			sDate = new Date(mkYear, mkMonth, 7);
			sList = [
						new MK_Schedule(allDay, "MassKara Art Weekend", undefined,"Opening of art events: MassKara 9 group show, Magika MassKara, Art Tour")
						, new MK_Schedule(["6:00 pm", "8:00 pm"], "Installation: Majika Masskara floats in host venues")
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 12
			sDate = new Date(mkYear, mkMonth, 12);
			sList = [
						new MK_Schedule(["12:00 pm", "1:00 pm"], "i-Witness DocuFest wth GMA News and Public Affairs personalities", 2)					
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 13
			sDate = new Date(mkYear, mkMonth, 13);
			sList = [
						new MK_Schedule(["5:00 pm", "7:00 pm"], "Little Miss MassKara (pageant night)")
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );


			// 2012 Oct 14
			sDate = new Date(mkYear, mkMonth, 14);
			sList = [
						new MK_Schedule(["5:00 pm", "9:00 pm"], "MassKara Preview: A Fashion Show of MassKara Streetdancing Costumes", 0)
					];
			
			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 19
			sDate = new Date(mkYear, mkMonth, 19);
			sList = [
						new MK_Schedule(["6:00 pm", "11:59 pm"], "Electric MassKara Day 1: Lights Up, Music On", 3, "Street Parties at Tourism Strip and Bacolod Public Plaza continue all night long")
						, new MK_Schedule(["7:00 pm", "9:00 pm"], "(Pagkilita-ay, Pakita-ay) parade kicks off from various parts of Bacolod", 3, "Street Parties at Tourism Strip and Bacolod Public Plaza continue all night long")
						, new MK_Schedule(["9:00 pm", "10:00 pm"], "Floats converge", 3)
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 20
			sDate = new Date(mkYear, mkMonth, 20);
			sList = [
						new MK_Schedule(["3:00 pm", "7:00 pm"], "Streetdance - Schools Category From Libertad Araneta to Bacolod Public Plaza", 0)
						, new MK_Schedule(["4:00 pm", "6:00 pm"], "Kapuso Mall Show", 2)
						, new MK_Schedule(["4:00 pm", "7:30 pm"], "MassKara Arena Competitions Schools", 0)
						, new MK_Schedule(["6:00 pm", "11:59 pm"], "Electric MassKara Day 2: Lights Up, Music On", 3, "Street Parties at Tourism Strip and Bacolod Public Plaza continue all night long")
						, new MK_Schedule(["8:00 pm", "9:00 pm"], "Electric MassKara Performing Float Competitions Kick off ", 2, "Street Parties at Tourism Strip and Bacolod Public Plaza continue all night long")
						, new MK_Schedule(["9:00 pm", "11:00 pm"], "Electric MassKara Floats converge", 3, "Street Parties at Tourism Strip and Bacolod Public Plaza continue all night long")
						, new MK_Schedule(["10:30 pm", "11:30 pm"], "Cosplay on the Glow: The ABS-CBN/ MOR 101.5 Electric Cosplay competition", 3, "Street Parties at Tourism Strip and Bacolod Public Plaza continue all night long")

					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 21
			sDate = new Date(mkYear, mkMonth, 21);
			sList = [
						new MK_Schedule(["3:00 pm", "10:00 pm"], "Streetdance - Barangay Category From Libertad Araneta to Bacolod Public Plaza", 0)
						, new MK_Schedule(["4:00 pm", "7:30 pm"], "MassKara Arena Competitions Barangays", 0)
						, new MK_Schedule(["6:00 pm", "11:59 pm"], "Electric MassKara Day 3", 3, "Street Parties at Tourism Strip and Bacolod Public Plaza continue all night long")
						, new MK_Schedule(["7:00 pm", "9:00 pm"], "Winners' Showdown Electric MassKara float competition")
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

			// 2012 Oct 22
			sDate = new Date(mkYear, mkMonth, 22);
			sList = [
						new MK_Schedule(["7:00 pm", "11:00 pm"], "MassKara Festival Closing Ceremonies/DanssKara Grand Finals/Kapuso Night", 0, "Street parties at Bacolod Public Plaza continue")					
					];

			gArr_sList.push( new MK_DaySchedules( sDate , sList ) );

		}


		$(document).on('mobileinit', function() {
			$.mobile.defaultPageTransition = "none";
		});

		$(document).ready(function() {
			$pMain = $("#pMain");

			init_vals();
			init_Places();
			init_Schedules();

		 });


		$(document).on('pageinit', '#pMain', function() {
			init_Selectors();		

			gObj_cNB = new MK_Navi ( $NB_Sch , $c_Sch );

			// Show Schedule Content
			gObj_cNB.show();


			// add Events
			$NB_Sch.on("click", function(){
				gObj_cNB.change( $NB_Sch , $c_Sch );
			});

			$NB_Venue.on("click", function(){
				gObj_cNB.change( $NB_Venue , $c_Venue );

			});

			$NB_Fav.on("click", function(){
				gObj_cNB.change( $NB_Fav , $c_Fav );
			});

			$NB_Info.on("click", function(){
				gObj_cNB.change( $NB_Info , $c_Info );
			});

			$pMC_RB.on("click", function(){
				gObj_Cal_UI.click_RBtn();
			});

			$pMC_LB.on("click", function(){
				gObj_Cal_UI.click_LBtn();
			});

			$pMC_Popup.bind({
				popupbeforeposition: function(event, ui) {
					gObj_Cal_UI.update_selPL();
				}
			});

			$pMC_Sel.on("click", function(){
				$pMC_Popup.popup( "open" );
			});


			$pMC_SelPL.on("click", "li", function(){
				var idx = $(this).data('idx');

				if( idx > -1 ) {
					gObj_Cal_UI.select_pDate( idx );
					$pMC_Popup.popup( "close" );
				}
			});


			gObj_Cal_UI = new MK_UI_Calendar( );

		});

	</script>

	<script src="js/jquery.mobile-1.2.0-rc.1.min.js"></script>

</head>

<body> 

<!-- Start of Main Page -->
<div data-role="page" id="pMain"  data-theme="d">

	<div data-role="header"  data-position="fixed" data-tap-toggle="false" id="pMain_HD"> 			
		<h1>MassKara 2012</h1>

		<div data-role="navbar">
		   <ul>
			 <li><a data-icon="grid" id="NB_Sch" class="ui-btn-active">Schedule</a></li>
			 <li><a data-icon="home" id="NB_Venue" >Venues</a></li>
			 <li><a data-icon="star" id="NB_Fav" >Favorite</a></li>
			 <li><a data-icon="info" id="NB_Info" >Info</a></li>
		   </ul>
		</div>

		<div style="clear:both" id="pMain_Cal"> 
			<div class="ui-grid-b" style="padding:5px 0">
				<div class="ui-block-a">
					<span>
					<button data-mini="false" data-inline="true" data-icon="arrow-l"  data-theme="e" id="pMC_LB"></button>
					</span>
				</div>
				<div class="ui-block-b">

					<button data-rel="popup" data-role="button" data-mini="false" data-theme="c"  id="pMC_Sel"></button>
					<div data-role="popup" id="popupSelDate">
						<ul data-role="listview" data-inset="true" data-theme="e">
						</ul>
					</div>

				</div>
				<div class="ui-block-c" style="text-align:right">
					<span>
					<button data-mini="false" data-inline="true" data-icon="arrow-r" data-iconpos="right" data-theme="e" id="pMC_RB"></button>
					</span>
				</div>
			</div>
		</div>


	</div>  <!-- /header #pMain_HD -->

	<div data-role="content" id="pMain_Content">

		<div id="c_Sch" class="pm_content"> 
			<ul data-role="listview" data-inset="false" data-theme="c">
			</ul>
		</div>

		<div id="c_Venue" class="pm_content"> 
			Place
		</div>

		<div id="c_Fav" class="pm_content"> 
			Favorite
		</div>

		<div id="c_Info" class="pm_content"> 
			<ul data-role="listview" data-mini="true" data-inset="true" data-theme="c">
				<li><a><img src="css/image/star.png" class="ui-li-icon" /><h3 class="ui-li-heading">adsfj adfj adf</h3><p class="ui-li-desc">adfdaf</p></a></li>
				<li><a><img src="css/image/star.png" class="ui-li-icon" /><h3 class="ui-li-heading">adsfj adfj adf</h3><p class="ui-li-desc">adfdaf</p></a></li>
				<li><a><img src="css/image/star.png" class="ui-li-icon" /><h3 class="ui-li-heading">adsfj adfj adf</h3><p class="ui-li-desc">adfdaf</p></a></li>
			</ul>


		</div>

	</div> <!-- /content #pMain_Content -->


</div><!-- /page #pMain -->

</body>
</html>